<%# Welcome page after successful login %>
<meta name="viewport" content="width=device-width, initial-scale=1">

<div  class="banner" >
  <div class="title-container">
    <h1>Project Overview</h1>
    <% if current_user.role == "manager" %>
    <% else %>
      <h2>Location: <strong><%= current_user.location.name %></strong></h2>
    <% end %>
  </div>

  <div class="container">
    <div class="wrapper-container">
      <div class="grid-container">
        <div class="card py-4">
          <h4>Pending Approval <i class="fa-solid fa-list-check" style="color: #3898b9;"></i></h4>
          <% if current_user.role == "engineer" %>
            <p>You have <%= @item_request_count %> pending approval </p>
          <% else %>
            <p>You have <%= @item_request_manager_count %> pending approval </p>
          <% end %>

          <%= link_to "Pending requests", requests_path, class: "btn btn-primary", id: "view-request-btn" %>
        </div>

        <div class="card py-4">
          <h4>Tracking Delivery  <i class="fa-solid fa-truck-fast fa-bounce" style="color: #3a98b9;"></i>
          </h4>
          <p>lorem ipsum 2 hello hello</p>

          <%= link_to "Tracking delivery", "#", class: "btn btn-info", id: "transit-delivery-btn" %>
        </div>

        <div class="card py-4">
          <h4>Low Stock Alert  <i class="fa-solid fa-bell fa-bounce" style="color: #de1721;"></i>
          </h4>
          <p>lorem ipsum 3</p>
          <%= link_to "Stock Alert", "#", class: "btn btn-danger", id: "stock-alert-btn" %>
        </div>
      </div>
    </div>

    <div class="bottom-container">
      <div class="map-card">
        <% materials_by_location = Material.where(location: current_user.location).group(:name).sum(:qty) %>
        <%= pie_chart materials_by_location %>
      </div>

      <div class="map-card">
        <p style="color: green"><%= notice %></p>
        <h3>Project Site Locations</h3>

        <div data-controller="map"
          id='map'
          data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"
          data-map-markers-value="<%= @markers.to_json %>"
          style='width: auto; height: 370px;'>
        </div>
      </div>

    </div>
  </div>

</div>
