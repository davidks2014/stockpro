<div class="container">
  <% if @item_requests.any? %>
    <% if @item_requests.first.del_approv_status == "Declined" %>
      <h1>Declined Item Requests</h1>
     <% else %>
      <%# <div class="moving-truck">
        <i class="fa-solid fa-truck-fast fa-bounce fa-2xl"></i>
      </div> %>

      <h1>Arrange Delivery</h1>
      <br>
    <% end %>
    <div>
      <%# raise %>
      <% if @item_requests.any? %>
        <% filtered_item_requests = @item_requests.select do |x| %>
          <% x.request.location == current_user.location %>
        <% end %>
          <%# raise %>
          <% filtered_item_requests.group_by { |item_request| Location.find(item_request.request.original_location_id).name }.each do |loc, item_requests| %>
            <div>
              <%= simple_form_for @delivery_order, url: delivery_orders_path do |f|%>
                <h2>Deliver to <%= loc %></h2>
                <table class="table table-bordered table-striped table-hover">
                  <thead>
                    <tr>
                      <th>Request ID</th>
                      <th>Item Request ID</th>
                      <th>Item Type</th>
                      <th>Name</th>
                      <th>Unit Price</th>
                      <th>Qty</th>
                      <% if item_requests.first.del_approv_status == "Declined" %>

                      <% else %>
                        <th>Group for delivery</th>
                      <% end %>
                    </tr>
                  </thead>
                  <tbody>
                    <% filtered_item_requests.each do |item_request| %>
                      <% if Location.find(item_request.request.original_location_id).name == loc && item_request.delivery_order == nil %>
                        <tr class="tablerow" id=<%= item_request.id %>>

                          <td><%= item_request.request.id %></td>
                          <td><%= item_request.id %></td>
                          <td><%= "#{item_request.item.class.to_s}" %></td>
                          <td><%= item_request.item.name %></td>
                          <% if item_request.item.is_a? Material %>
                            <td>$<%= item_request.item.unit_price %></td>
                          <% else %>
                            <td>N/A</td>
                          <% end %>
                          <td><%= item_request.qty %></td>
                          <% if item_requests.first.del_approv_status == "Declined" %>
                          <% else %>
                          <td>
                          <%#if u want to select all, use checked in input %>
                            <input type="checkbox" name="selected_item_request_ids[]" value="<%= item_request.id %>">
                          </td>
                          <% end %>
                        </tr>
                      <% end %>
                    <% end %>
                  </tbody>
                </table>
                <% if item_requests.first.del_approv_status == "Declined" %>

                <% else %>
                  <%= f.submit "confirm delivery" %>
                <% end %>

                <%# <script>
                  document.addEventListener("DOMContentLoaded", function() {
                    const confirmDeliveryButton = document.getElementById("confirm-delivery-button");
                    const movingTruckIcon = document.querySelector(".moving-truck i");

                    confirmDeliveryButton.addEventListener("click", function() {
                      // Add a CSS class to trigger the animation
                      movingTruckIcon.style.animationName = "speed";
                      movingTruckIcon.style.animationDuration = "5s";
                      movingTruckIcon.style.animationTimingFunction = "linear";
                      movingTruckIcon.style.animationIterationCount = "1"; // Play the animation only once
                      movingTruckIcon.style.animationFillMode = "forwards";

                      // Adjust the starting and ending positions if needed
                      movingTruckIcon.style.left = "60%"; // Starting position
                      setTimeout(function() {
                        movingTruckIcon.style.left = "105%"; // Ending position (move off-screen to the right)
                      }, 0); // Delay is set to 0 to ensure the animation starts immediately
                    });
                  });
                </script> %>

              <% end %>
            </div>
            <br>
          <% end %>
      <% end %>
    </div>
  <% else %>
    <h1> You have no items pending delivery </h1>
  <% end %>

</div>
