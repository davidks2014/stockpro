<div class="container">
  <h1>Arrange Delivery</h1>
    <div data-controller="confirmdelivery">
    <% if current_user.location == @item_requests.first.request.location %>
      <% @item_requests.group_by { |item_request| Location.find(item_request.request.original_location_id).name }.each do |location_name, item_requests| %>
        <div>
          <%= form_with url: delivery_orders_path, method: :post, data: {action: "submit->confirmdelivery#submit"} do %>
            <h2><%= location_name %></h2>
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Deliver To</th>
                  <th>Request ID</th>
                  <th>Item Request ID</th>
                  <th>Type and ID</th>
                  <th>Name</th>
                  <th>Unit Price</th>
                  <th>Qty</th>
                  <th>Group for delivery</th>
                </tr>
              </thead>
              <tbody>
                <% @item_requests.each do |item_request| %>
                  <% if Location.find(item_request.request.original_location_id).name == location_name %>
                    <tr>
                      <td><%= Location.find(item_request.request.original_location_id).name %></td>
                      <td><%= item_request.request.id %></td>
                      <td><%= item_request.id %></td>
                      <td><%= "#{item_request.item.class.to_s} #{item_request.item.id}" %></td>
                      <td><%= item_request.item.name %></td>
                      <% if item_request.item.is_a? Material %>
                        <td>$<%= item_request.item.unit_price %></td>
                      <% else %>
                        <td>N/A</td>
                      <% end %>
                      <td><%= item_request.qty %></td>
                      <td>
                      <%#if u want to select all, use checked in input %>
                        <input type="checkbox" name="checkbox" id=<%= item_request.id %> value="" data-confirmdelivery-target="checkbox">
                      </td>
                    </tr>
                  <% end %>
                <% end %>
              </tbody>
            </table>
            <%= submit_tag "confirm delivery" %>
          <% end %>
        </div>
      <% end %>
    <% end %>
    </div>
</div>
