
<%# only show those items others are requesting from user%>

<div class="container">
<h2>Received requests</h2>
  <% @requests.each do |request| %>
    <% if current_user.location == request.location %>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Request to</th>
            <th>Request from</th>
            <th>Request ID</th>
            <th>Item Request ID</th>
            <th>Type and ID</th>
            <th>Name</th>
            <th>Qty</th>
            <th>UOM</th>
            <th>Unit Price</th>
            <th>Engineer Approval</th>
            <th>Manager Approval</th>
          </tr>
        </thead>
        <tbody>
          <% request.item_requests.each do |item_request| %>
            <tr>
            <td><%= request.location.name %></td>
            <td><%= Location.find(request.original_location_id).name %></td>
            <td><%= request.id %></td>
            <td><%= item_request.id %></td>
            <td><%= "#{item_request.item.class.to_s} #{item_request.item.id}" %></td>
            <td><%= item_request.item.name %></td>
            <td><%= item_request.item.qty %></td>
            <% if item_request.item.is_a? Material %>
              <td><%= item_request.item.uom %></td>
            <% else %>
              <td>N/A</td>
            <% end %>
            <% if item_request.item.is_a? Material %>
              <td>$<%= item_request.item.unit_price %></td>
            <% else %>
              <td>N/A</td>
            <% end %>

            <td>
            <%= link_to "Approve", item_request_eng_approve_path(item_request), method: :post, data: {turbo_method: :post}, class: "btn btn-success" %>
            <%= link_to "Decline", item_request_eng_decline_path(item_request), method: :post, data: {turbo_method: :post}, class: "btn btn-danger" %>
            </td>

            <td>
            <%= link_to "Approve", item_request_man_approve_path(item_request), method: :post, data: {turbo_method: :post}, class: "btn btn-success" %>
            <%= link_to "Decline", item_request_man_decline_path(item_request), method: :post, data: {turbo_method: :post}, class: "btn btn-danger" %>
            </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  <% end %>
</div>

<div class="container">
<h2>Sent requests</h2>

  <% @requests.each do |request| %>
    <% if current_user.location == Location.find(request.original_location_id) %>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Request to</th>
            <th>Request from</th>
            <th>Request ID</th>
            <th>Item Request ID</th>
            <th>Type and ID</th>
            <th>Name</th>
            <th>Qty</th>
            <th>UOM</th>
            <th>Unit Price</th>
            <th>Deliver Approval Status</th>
          </tr>
        </thead>
        <tbody>
          <% request.item_requests.each do |item_request| %>
            <tr>
            <td><%= request.location.name %></td>
            <td><%= User.find(request.user_id).location.name %></td>
            <td><%= request.id %></td>
            <td><%= item_request.id %></td>
            <td><%= "#{item_request.item.class.to_s} #{item_request.item.id}" %></td>
            <td><%= item_request.item.name %></td>
            <td><%= item_request.item.qty %></td>
            <% if item_request.item.is_a? Material %>
              <td><%= item_request.item.uom %></td>
            <% else %>
              <td>N/A</td>
            <% end %>
            <% if item_request.item.is_a? Material %>
              <td>$<%= item_request.item.unit_price %></td>
            <% else %>
              <td>N/A</td>
            <% end %>
            <td><%= item_request.del_approv_status %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  <% end %>
</div>
